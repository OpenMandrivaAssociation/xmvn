From c9884f33ea7f09fd7e2dbd8c0d35835ae0bfb463 Mon Sep 17 00:00:00 2001
From: Mikolaj Izdebski <mizdebsk@redhat.com>
Date: Wed, 25 Mar 2015 10:23:13 +0100
Subject: [PATCH 1/2] Port to Gradle 2.4-rc-1

---
 .../xmvn/connector/gradle/GradleResolver.java             | 15 +++++++++------
 xmvn-parent/pom.xml                                       |  2 +-
 2 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/xmvn-connector-gradle/src/main/java/org/fedoraproject/xmvn/connector/gradle/GradleResolver.java b/xmvn-connector-gradle/src/main/java/org/fedoraproject/xmvn/connector/gradle/GradleResolver.java
index af4d068..a5d655f 100644
--- a/xmvn-connector-gradle/src/main/java/org/fedoraproject/xmvn/connector/gradle/GradleResolver.java
+++ b/xmvn-connector-gradle/src/main/java/org/fedoraproject/xmvn/connector/gradle/GradleResolver.java
@@ -36,6 +36,8 @@ import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.ModuleComponentRe
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.parser.DescriptorParseContext;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.parser.GradlePomModuleDescriptorParser;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.parser.MetaDataParser;
+import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.DefaultVersionComparator;
+import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.DefaultVersionSelectorScheme;
 import org.gradle.api.internal.artifacts.repositories.ResolutionAwareRepository;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.internal.component.external.model.DefaultMavenModuleResolveMetaData;
@@ -54,10 +56,10 @@ import org.gradle.internal.resolve.ModuleVersionResolveException;
 import org.gradle.internal.resolve.result.BuildableArtifactResolveResult;
 import org.gradle.internal.resolve.result.BuildableArtifactSetResolveResult;
 import org.gradle.internal.resolve.result.BuildableModuleComponentMetaDataResolveResult;
-import org.gradle.internal.resolve.result.BuildableModuleComponentVersionSelectionResolveResult;
-import org.gradle.internal.resource.DefaultLocallyAvailableExternalResource;
-import org.gradle.internal.resource.LocallyAvailableExternalResource;
+import org.gradle.internal.resolve.result.BuildableModuleVersionListingResolveResult;
+import org.gradle.internal.resource.local.DefaultLocallyAvailableExternalResource;
 import org.gradle.internal.resource.local.DefaultLocallyAvailableResource;
+import org.gradle.internal.resource.local.LocallyAvailableExternalResource;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.w3c.dom.Document;
@@ -159,7 +161,7 @@ public class GradleResolver
     }
 
     @Override
-    public void listModuleVersions( DependencyMetaData arg0, BuildableModuleComponentVersionSelectionResolveResult arg1 )
+    public void listModuleVersions( DependencyMetaData arg0, BuildableModuleVersionListingResolveResult arg1 )
     {
         logger.debug( "listModuleVersions() called, but it is NOT IMPLEMENTED" );
     }
@@ -207,8 +209,9 @@ public class GradleResolver
             Path fakePom = fakePom( pomPath, id );
             logger.debug( "Created fake POM: {}", fakePom );
 
-            MetaDataParser parser = new GradlePomModuleDescriptorParser();
-            MutableModuleComponentResolveMetaData metaData = parser.parseMetaData( this, fakePom.toFile() );
+            MetaDataParser<DefaultMavenModuleResolveMetaData> parser =
+                new GradlePomModuleDescriptorParser( new DefaultVersionSelectorScheme( new DefaultVersionComparator() ) );
+            MutableModuleComponentResolveMetaData metaData = parser.parseMetaData( this, pomPath.toFile() );
 
             result.resolved( metaData );
             return;
diff --git a/xmvn-parent/pom.xml b/xmvn-parent/pom.xml
index 041215a..a9f055e 100644
--- a/xmvn-parent/pom.xml
+++ b/xmvn-parent/pom.xml
@@ -79,7 +79,7 @@
     <atinjectVersion>1</atinjectVersion>
     <ivyVersion>2.4.0</ivyVersion>
     <jcommanderVersion>1.47</jcommanderVersion>
-    <gradleVersion>2.2.1</gradleVersion>
+    <gradleVersion>2.4-rc-1</gradleVersion>
     <guiceVersion>3.2.5</guiceVersion>
     <guavaVersion>18.0</guavaVersion>
     <mavenInvokerVersion>2.1.1</mavenInvokerVersion>
-- 
2.1.0

